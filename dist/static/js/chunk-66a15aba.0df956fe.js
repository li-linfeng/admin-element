(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-66a15aba"],{"0317":function(e,t,a){"use strict";a("5747")},2861:function(e,t,a){},5747:function(e,t,a){},"5b40":function(e,t,a){"use strict";a("2861")},"622d":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"filter-container",staticStyle:{display:"inline"}},[a("el-select",{staticClass:"filter-item",staticStyle:{width:"130px","margin-right":"10px"},attrs:{placeholder:"搜索字段",clearable:""},model:{value:e.col,callback:function(t){e.col=t},expression:"col"}},e._l(e.cols,(function(e){return a("el-option",{key:e.key,attrs:{label:e.name,value:e.key}})})),1),a("el-input",{staticClass:"filter-item",staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"输入搜索内容"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.val,callback:function(t){e.val=t},expression:"val"}}),e.status.length>0?a("el-select",{staticClass:"filter-item",staticStyle:{width:"130px"},attrs:{placeholder:"状态",clearable:""},model:{value:e.sta,callback:function(t){e.sta=t},expression:"sta"}},e._l(e.status,(function(e){return a("el-option",{key:e.key,attrs:{label:e.name,value:e.key}})})),1):e._e(),a("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v(" 搜索 ")])],1)},l=[],r={name:"QueryCol",props:{filter_col:{type:String},filter_val:{type:String},filter_status:{type:String},cols:{type:Array,default:function(){return[]}},status:{type:Array,default:function(){return[]}}},data:function(){return{col:this.filter_col,val:this.filter_val,sta:this.filter_status}},created:function(){},methods:{search:function(){var e={col:this.col,val:this.val,sta:this.sta};this.$emit("handleFilter",e)}}},n=r,o=(a("0317"),a("2877")),s=Object(o["a"])(n,i,l,!1,null,null,null);t["a"]=s.exports},"8a0a":function(e,t,a){"use strict";a("a6c3")},"91b6":function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var i=a("b775");function l(e){return Object(i["a"])({url:"/api/upload",method:"post",data:e})}},a15b:function(e,t,a){"use strict";var i=a("23e7"),l=a("44ad"),r=a("fc6a"),n=a("a640"),o=[].join,s=l!=Object,c=n("join",",");i({target:"Array",proto:!0,forced:s||!c},{join:function(e){return o.call(r(this),void 0===e?",":e)}})},a434:function(e,t,a){"use strict";var i=a("23e7"),l=a("23cb"),r=a("a691"),n=a("50c4"),o=a("7b0b"),s=a("65f0"),c=a("8418"),u=a("1dde"),d=a("ae40"),f=u("splice"),p=d("splice",{ACCESSORS:!0,0:0,1:2}),h=Math.max,m=Math.min,y=9007199254740991,b="Maximum allowed length exceeded";i({target:"Array",proto:!0,forced:!f||!p},{splice:function(e,t){var a,i,u,d,f,p,g=o(this),_=n(g.length),v=l(e,_),k=arguments.length;if(0===k?a=i=0:1===k?(a=0,i=_-v):(a=k-2,i=m(h(r(t),0),_-v)),_+a-i>y)throw TypeError(b);for(u=s(g,i),d=0;d<i;d++)f=v+d,f in g&&c(u,d,g[f]);if(u.length=i,a<i){for(d=v;d<_-i;d++)f=d+i,p=d+a,f in g?g[p]=g[f]:delete g[p];for(d=_;d>_-i+a;d--)delete g[d-1]}else if(a>i)for(d=_-i;d>v;d--)f=d+i-1,p=d+a-1,f in g?g[p]=g[f]:delete g[p];for(d=0;d<a;d++)g[d+v]=arguments[d+2];return g.length=_-i+a,u}})},a6c3:function(e,t,a){},a9e3:function(e,t,a){"use strict";var i=a("83ab"),l=a("da84"),r=a("94ca"),n=a("6eeb"),o=a("5135"),s=a("c6b6"),c=a("7156"),u=a("c04e"),d=a("d039"),f=a("7c73"),p=a("241c").f,h=a("06cf").f,m=a("9bf2").f,y=a("58a8").trim,b="Number",g=l[b],_=g.prototype,v=s(f(_))==b,k=function(e){var t,a,i,l,r,n,o,s,c=u(e,!1);if("string"==typeof c&&c.length>2)if(c=y(c),t=c.charCodeAt(0),43===t||45===t){if(a=c.charCodeAt(2),88===a||120===a)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:i=2,l=49;break;case 79:case 111:i=8,l=55;break;default:return+c}for(r=c.slice(2),n=r.length,o=0;o<n;o++)if(s=r.charCodeAt(o),s<48||s>l)return NaN;return parseInt(r,i)}return+c};if(r(b,!g(" 0o1")||!g("0b1")||g("+0x1"))){for(var w,x=function(e){var t=arguments.length<1?0:e,a=this;return a instanceof x&&(v?d((function(){_.valueOf.call(a)})):s(a)!=b)?c(new g(k(t)),a,x):k(t)},C=i?p(g):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),S=0;C.length>S;S++)o(g,w=C[S])&&!o(x,w)&&m(x,w,h(g,w));x.prototype=_,_.constructor=x,n(l,b,x)}},e9c4:function(e,t,a){var i=a("23e7"),l=a("d066"),r=a("d039"),n=l("JSON","stringify"),o=/[\uD800-\uDFFF]/g,s=/^[\uD800-\uDBFF]$/,c=/^[\uDC00-\uDFFF]$/,u=function(e,t,a){var i=a.charAt(t-1),l=a.charAt(t+1);return s.test(e)&&!c.test(l)||c.test(e)&&!s.test(i)?"\\u"+e.charCodeAt(0).toString(16):e},d=r((function(){return'"\\udf06\\ud834"'!==n("\udf06\ud834")||'"\\udead"'!==n("\udead")}));n&&i({target:"JSON",stat:!0,forced:d},{stringify:function(e,t,a){var i=n.apply(null,arguments);return"string"==typeof i?i.replace(o,u):i}})},e9f7:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cate-div"},[a("div",{staticClass:"filter-container",staticStyle:{"margin-bottom":"20px"}},[a("QueryCol",{attrs:{cols:e.cols,filter_col:e.listQuery.filter_col,filter_val:e.listQuery.filter_val},on:{handleFilter:e.handleFilter}})],1),a("el-table",{ref:"tableRef",staticClass:"cate-table",attrs:{data:e.data,"row-key":"key",border:"",fit:"","default-expand-all":"","header-cell-class-name":e.headerStyle,"row-class-name":e.tableRowStyle,"tree-props":{children:"children",hasChildren:"hasChildren"}}},[a("el-table-column",{attrs:{align:"left",prop:"id",label:"编号",sortable:"",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(i.index))])]}}])}),a("el-table-column",{attrs:{align:"center",label:"物料号",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(i.name))])]}}])}),a("el-table-column",{attrs:{align:"left",label:"描述",width:"400"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.description)+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:"物料属性",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.property)+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:"数量",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.amount)+" ")]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return["XX"==i.code?a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.showAddMaterialDialog(i,"component")}}},[e._v(" 添加零件 ")]):e._e(),"category"!=i.type&&i.has_child>0?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.showAddMaterialDialog(i)}}},[e._v(" 添加子组件 ")]):e._e(),"category"!=i.type&&i.has_child>0?a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.showChoose(i)}}},[e._v(" 选择子组件 ")]):e._e(),"XX"!=i.code&&"category"==i.type?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showAddMaterialDialog(i)}}},[e._v(" 添加产品 ")]):e._e()]}}])})],1),a("material",{ref:"material",attrs:{category_id:e.category_id,dialogType:e.dialogType,need_refresh:e.need_refresh,visible:e.dialogFormVisible},on:{"update:need_refresh":function(t){e.need_refresh=t},"update:visible":function(t){e.dialogFormVisible=t}}}),a("el-dialog",{attrs:{visible:e.showChooseDialog,title:"选择子组件"},on:{close:function(t){e.showChooseDialog=!1}}},[a("el-form",{ref:"combineForm",staticStyle:{width:"400px","margin-left":"10px"},attrs:{model:e.combine,"label-position":"left","label-width":"100px"}},[a("el-form-item",{attrs:{label:"搜索"}},[a("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),a("el-tree",{ref:"tree",staticStyle:{"margin-top":"20px",width:"500px"},attrs:{data:e.tree,"check-strictly":!0,"show-checkbox":"","node-key":"description","default-expand-all":!0,"filter-node-method":e.filterNode,"expand-on-click-node":!1},on:{"check-change":e.checkChange},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node;return a("span",{staticClass:"custom-tree-node"},[a("span",[e._v(e._s(i.label))])])}}])})],1),e.combine.children.length>0?a("div",e._l(e.combine.children,(function(t,i){return a("el-form-item",{key:t.label,attrs:{label:"物料"+(1*i+1)+"数量"}},[a("span",{staticStyle:{padding:"10px",float:"left","line-height":"25px","margin-right":"20px"}},[e._v(e._s(e.combine.children[i].description))]),a("el-input-number",{staticClass:"small_input el-item",model:{value:e.combine.children[i].amount,callback:function(t){e.$set(e.combine.children[i],"amount",t)},expression:"combine.children[index].amount"}})],1)})),1):e._e()],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.showChooseDialog=!1}}},[e._v(" 取消 ")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.bindRel()}}},[e._v(" 确认 ")])],1)],1)],1)},l=[],r=a("5530"),n=(a("4de4"),a("d3b7"),a("e9c4"),a("a4d3"),a("e01a"),a("d81d"),a("a434"),a("b775"));function o(e){return Object(n["a"])({url:"/api/material_tree",method:"get",params:e})}function s(e){return Object(n["a"])({url:"/api/materials",method:"post",data:e})}function c(e,t){return Object(n["a"])({url:"/api/materials/".concat(e,"/rel"),method:"post",data:t})}function u(e){return Object(n["a"])({url:"/api/categories",method:"get",params:e})}var d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"custom-tree-container"},[a("el-dialog",{attrs:{visible:e.visible,"append-to-body":""},on:{close:e.handleClose}},[a("el-form",{ref:"materialForm",staticStyle:{width:"400px","margin-left":"20px"},attrs:{rules:e.rules,model:e.material,"label-position":"left","label-width":"120px"}},[a("el-form-item",{attrs:{label:"物料类型",prop:"type"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择"},model:{value:e.material.type,callback:function(t){e.$set(e.material,"type",t)},expression:"material.type"}},e._l(e.material_types[e.dialogType],(function(e){return a("el-option",{key:e.key,staticClass:"el-item",attrs:{label:e.key,value:e.val}})})),1)],1),a("el-form-item",{attrs:{label:"物料编号",prop:"label"}},[a("el-input",{staticClass:"small_input",model:{value:e.material.label,callback:function(t){e.$set(e.material,"label",t)},expression:"material.label"}})],1),"component"!=e.dialogType?a("el-form-item",{attrs:{label:"是否有子分类",prop:"has_child"}},[a("el-radio",{attrs:{label:"1"},model:{value:e.material.has_child,callback:function(t){e.$set(e.material,"has_child",t)},expression:"material.has_child"}},[e._v("是")]),a("el-radio",{attrs:{label:"0",checked:"checked"},model:{value:e.material.has_child,callback:function(t){e.$set(e.material,"has_child",t)},expression:"material.has_child"}},[e._v("否")])],1):e._e(),a("el-form-item",{attrs:{label:"物料属性",prop:"property"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"请选择"},model:{value:e.material.property,callback:function(t){e.$set(e.material,"property",t)},expression:"material.property"}},e._l(e.property_options,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"描述",prop:"description"}},[a("el-input",{staticClass:"small_input el-item",staticStyle:{width:"300px"},attrs:{type:"textarea",rows:4},model:{value:e.material.description,callback:function(t){e.$set(e.material,"description",t)},expression:"material.description"}})],1),a("el-form-item",{attrs:{label:"附件"}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"uploadFile","before-upload":e.beforeUpload,"on-remove":e.handleRemove,"file-list":e.fileList}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(){return e.addMaterial()}}},[e._v(" 确认 ")])],1)],1)],1)},f=[],p=(a("a9e3"),a("a15b"),a("91b6")),h={name:"Material",props:{need_refresh:{type:Boolean,default:!1},category_id:{type:Number,default:0},visible:{type:Boolean},dialogType:{type:String,default:"category"}},data:function(){return{refresh:!1,dialogFormVisible:!1,fileList:[],material_types:{category:[{key:"装配体",val:"assembly"}],assembly:[{key:"子装配体",val:"sub-assembly"},{key:"零件",val:"component"}],"sub-assembly":[{key:"零件",val:"component"}],component:[{key:"公用零件",val:"single-component"}]},property_options:[{value:"机加工",label:"机加工"},{value:"毛坯",label:"毛坯"},{value:"标准件",label:"标准件"},{value:"五金件",label:"五金件"},{value:"橡塑件",label:"橡塑件"}],material:{parent_id:0,category_id:0,type:"",seq:"",label:"",has_child:"0",amount:1,file_ids:"",property:"",children:[]},rules:{type:[{required:!0,message:"请先选择物料类型",trigger:"blur"}],label:[{required:!0,message:"请获取物料编码",trigger:"blur"}],has_child:[{required:!0,message:"请选择是否有子分类",trigger:"change"}]}}},methods:{handleClose:function(){this.$emit("update:visible",!1),this.$emit("update:need_refresh",!0),this.material={parent_id:0,category_id:0,type:"",seq:"",label:"",has_child:"0",amount:1,file_ids:"",children:[]}},addMaterial:function(){var e=this;this.material.category_id=this.category_id;for(var t=[],a=0;a<this.fileList.length;a++)t.push(this.fileList[a].id);this.material.file_ids=t.join(),this.$nextTick((function(){e.$refs["materialForm"].validate((function(t){t&&s(e.material).then((function(t){e.handleClose()}))}))}))},handleRemove:function(e,t){this.fileList=t},beforeUpload:function(e,t){var a=this,i=new FormData;i.append("file",e),i.append("type","file"),i.append("source_type","material"),Object(p["a"])(i).then((function(e){a.fileList.push(e.data)}))}}},m=h,y=(a("5b40"),a("2877")),b=Object(y["a"])(m,d,f,!1,null,null,null),g=b.exports,_=a("622d"),v=a("2f62"),k={name:"MaterialIndex",components:{Material:g,QueryCol:_["a"]},computed:Object(r["a"])({},Object(v["b"])(["permissions"])),filters:{typesMap:function(e){var t={category:"",assembly:"装配体","sub-assembly":"子装配体",component:"零件","single-component":"公用零件"};return t[e]},colorsMap:function(e){var t={category:"success",assembly:"primary","sub-assembly":"info",component:"warning","single-component":"danger"};return t[e]}},data:function(){return{options:[],loading:!1,tree:[],filterText:"",category_id:0,need_refresh:!1,showChooseDialog:!1,data:[],dialogFormVisible:!1,dialogType:"category",listQuery:{page:1,per_page:10,filter_col:"",filter_val:""},combine:{material_id:0,children:[]},cols:[{key:"name",name:"分类名"},{key:"children.filter_label",name:"物料名称"},{key:"children.filter_description",name:"物料描述"}]}},watch:{need_refresh:{handler:function(e,t){1==e&&this.getList()}},filterText:function(e){this.$refs.tree.filter(e)}},created:function(){var e=this;this.listQuery.page=1,this.$nextTick((function(){e.$refs.tableRef.setCurrentRow(-1)})),this.$route.query.category_name&&(this.listQuery.filter_col="name",this.listQuery.filter_val=this.$route.query.category_name),this.getList()},methods:{getTreeData:function(){var e=this,t={filter_category_id:this.category_id,material_id:this.combine.material_id,type:this.combine.type};return this.tree=[],o(t).then((function(t){e.tree=t.data.tree,e.category=t.data.category}))},showChoose:function(e){var t=this;this.showChooseDialog=!0,this.category_id=e.category_id;var a=JSON.parse(JSON.stringify(e));this.$nextTick((function(){t.$refs["combineForm"].resetFields(),t.combine.material_id=a.id,t.combine.children=a.children,t.combine.type=a.type,t.getTreeData();for(var e=[],i=0;i<a.children.length;i++)e.push(a.children[i].description);t.$refs.tree.setCheckedKeys(e)}))},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},checkChange:function(e,t,a){if(e.id>0)if(t){var i={id:e.id,label:e.label,description:e.description,amount:1};this.combine.children.push(i)}else{var l=this.combine.children.map((function(e){return e.id})).indexOf(e.id);this.combine.children.splice(l,1)}},showAddMaterialDialog:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.dialogType=t||e.type,this.dialogFormVisible=!0,this.category_id=e.category_id},getList:function(){var e=this;return u(this.listQuery).then((function(t){t.data.length>0?e.data=t.data:e.data=[]}))},handleFilter:function(e){this.listQuery.page=1,this.listQuery.filter_col=e.col?e.col:"",this.listQuery.filter_val=e.val?e.val:"",this.getList()},retrieve:function(){var e=this;this.getList().then((function(t){e.dialogFormVisible=!1,e.$notify({title:"Success",message:"操作成功",type:"success",duration:2e3})}))},bindRel:function(){var e=this;0!=this.combine.children.length?c(this.combine.material_id,this.combine).then((function(t){e.showChooseDialog=!1,e.retrieve()})):this.$message({showClose:!0,message:"请选择子物料",type:"error"})},headerStyle:function(e){e.row,e.column,e.rowIndex,e.columnIndex;return"tableStyle"},tableRowStyle:function(e){var t=e.row;e.rowIndex;if("category"==t.type)return"level_0"}}},w=k,x=(a("8a0a"),Object(y["a"])(w,i,l,!1,null,null,null));t["default"]=x.exports}}]);