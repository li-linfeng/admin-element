(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-89b26f92"],{"0317":function(e,t,a){"use strict";a("5747")},5747:function(e,t,a){},"622d":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"filter-container",staticStyle:{display:"inline"}},[a("el-select",{staticClass:"filter-item",staticStyle:{width:"130px","margin-right":"10px"},attrs:{placeholder:"搜索字段",clearable:""},model:{value:e.col,callback:function(t){e.col=t},expression:"col"}},e._l(e.cols,(function(e){return a("el-option",{key:e.key,attrs:{label:e.name,value:e.key}})})),1),a("el-input",{staticClass:"filter-item",staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"输入搜索内容"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.val,callback:function(t){e.val=t},expression:"val"}}),e.status.length>0?a("el-select",{staticClass:"filter-item",staticStyle:{width:"130px"},attrs:{placeholder:"状态",clearable:""},model:{value:e.sta,callback:function(t){e.sta=t},expression:"sta"}},e._l(e.status,(function(e){return a("el-option",{key:e.key,attrs:{label:e.name,value:e.key}})})),1):e._e(),a("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v(" 搜索 ")])],1)},l=[],r={name:"QueryCol",props:{filter_col:{type:String},filter_val:{type:String},filter_status:{type:String},cols:{type:Array,default:function(){return[]}},status:{type:Array,default:function(){return[]}}},data:function(){return{col:this.filter_col,val:this.filter_val,sta:this.filter_status}},created:function(){},methods:{search:function(){var e={col:this.col,val:this.val,sta:this.sta};this.$emit("handleFilter",e)}}},n=r,o=(a("0317"),a("2877")),s=Object(o["a"])(n,i,l,!1,null,null,null);t["a"]=s.exports},"6d5e":function(e,t,a){"use strict";a("dfe1")},"91b6":function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var i=a("b775");function l(e){return Object(i["a"])({url:"/api/upload",method:"post",data:e})}},"95f9":function(e,t,a){"use strict";a("ec9d")},a15b:function(e,t,a){"use strict";var i=a("23e7"),l=a("44ad"),r=a("fc6a"),n=a("a640"),o=[].join,s=l!=Object,c=n("join",",");i({target:"Array",proto:!0,forced:s||!c},{join:function(e){return o.call(r(this),void 0===e?",":e)}})},a434:function(e,t,a){"use strict";var i=a("23e7"),l=a("23cb"),r=a("a691"),n=a("50c4"),o=a("7b0b"),s=a("65f0"),c=a("8418"),d=a("1dde"),u=a("ae40"),h=d("splice"),f=u("splice",{ACCESSORS:!0,0:0,1:2}),m=Math.max,p=Math.min,y=9007199254740991,b="Maximum allowed length exceeded";i({target:"Array",proto:!0,forced:!h||!f},{splice:function(e,t){var a,i,d,u,h,f,g=o(this),_=n(g.length),v=l(e,_),k=arguments.length;if(0===k?a=i=0:1===k?(a=0,i=_-v):(a=k-2,i=p(m(r(t),0),_-v)),_+a-i>y)throw TypeError(b);for(d=s(g,i),u=0;u<i;u++)h=v+u,h in g&&c(d,u,g[h]);if(d.length=i,a<i){for(u=v;u<_-i;u++)h=u+i,f=u+a,h in g?g[f]=g[h]:delete g[f];for(u=_;u>_-i+a;u--)delete g[u-1]}else if(a>i)for(u=_-i;u>v;u--)h=u+i-1,f=u+a-1,h in g?g[f]=g[h]:delete g[f];for(u=0;u<a;u++)g[u+v]=arguments[u+2];return g.length=_-i+a,d}})},dfe1:function(e,t,a){},e9c4:function(e,t,a){var i=a("23e7"),l=a("d066"),r=a("d039"),n=l("JSON","stringify"),o=/[\uD800-\uDFFF]/g,s=/^[\uD800-\uDBFF]$/,c=/^[\uDC00-\uDFFF]$/,d=function(e,t,a){var i=a.charAt(t-1),l=a.charAt(t+1);return s.test(e)&&!c.test(l)||c.test(e)&&!s.test(i)?"\\u"+e.charCodeAt(0).toString(16):e},u=r((function(){return'"\\udf06\\ud834"'!==n("\udf06\ud834")||'"\\udead"'!==n("\udead")}));n&&i({target:"JSON",stat:!0,forced:u},{stringify:function(e,t,a){var i=n.apply(null,arguments);return"string"==typeof i?i.replace(o,d):i}})},e9f7:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cate-div"},[a("div",{staticClass:"filter-container",staticStyle:{"margin-bottom":"20px"}},[a("QueryCol",{attrs:{cols:e.cols,filter_col:e.listQuery.filter_col,filter_val:e.listQuery.filter_val},on:{handleFilter:e.handleFilter}})],1),a("el-table",{staticClass:"cate-table",staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:e.data,"row-key":"key",border:"",stripe:"",fit:"","highlight-current-row":"","default-expand-all":"","tree-props":{children:"children",hasChildren:"hasChildren"}}},[a("el-table-column",{attrs:{align:"center",prop:"id",label:"编号",sortable:"",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s("category"==i.type?i.id:""))])]}}])}),a("el-table-column",{attrs:{align:"center",label:"名称",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{type:e._f("colorsMap")(i.type),size:"medium"}},[e._v(e._s(i.name))])],1)]}}])}),a("el-table-column",{attrs:{align:"center",label:"物料类型",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e._f("typesMap")(a.type))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:"工程处理人",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.handler?a.handler.username:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:"描述",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.description)+" ")]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return["XX"==i.code?a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.showAddMaterialDialog("component",i)}}},[e._v(" 添加零件 ")]):e._e(),"category"!=i.type&&i.has_child>0?a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.showChoose("assembly",i)}}},[e._v(" 选择子组件 ")]):e._e(),"XX"!=i.code&&"category"==i.type?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showAddMaterialDialog("category",i)}}},[e._v(" 添加产品 ")]):e._e(),"XX"!=i.code&&"category"==i.type&&-1!==e.permissions.indexOf("*")?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showAddHandlerDialog(i)}}},[e._v(" 设置处理人 ")]):e._e()]}}])})],1),a("material",{ref:"material",attrs:{category:e.category,dialogType:e.dialogType,need_refresh:e.need_refresh,visible:e.dialogFormVisible},on:{"update:need_refresh":function(t){e.need_refresh=t},"update:visible":function(t){e.dialogFormVisible=t}}}),a("el-dialog",{attrs:{visible:e.showChooseDialog,title:"选择子组件"},on:{close:function(t){e.showChooseDialog=!1}}},[a("el-container",[a("el-header",[a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:function(t){return e.showAddMaterialDialog("assembly")}}},[e._v(" 添加子组件 ")])],1),a("el-main",[a("el-form",{ref:"combineForm",staticStyle:{width:"400px","margin-left":"50px"},attrs:{model:e.combine,"label-position":"left","label-width":"120px"}},[a("el-form-item",{attrs:{label:"搜索"}},[a("el-input",{attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),a("el-tree",{ref:"tree",staticStyle:{"margin-top":"20px"},attrs:{data:e.tree,"check-strictly":!0,"show-checkbox":"","node-key":"label","default-expand-all":!0,"filter-node-method":e.filterNode,"expand-on-click-node":!1},on:{"check-change":e.checkChange},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node;return a("span",{staticClass:"custom-tree-node"},[a("span",[e._v(e._s(i.label))])])}}])})],1),e.combine.children.length>0?a("div",e._l(e.combine.children,(function(t,i){return a("el-form-item",{key:t.label,attrs:{label:"物料"+(1*i+1)+"数量"}},[a("span",{staticStyle:{padding:"10px",float:"left","line-height":"25px","margin-right":"20px"}},[e._v(e._s(e.combine.children[i].label))]),a("el-input-number",{staticClass:"small_input el-item",model:{value:e.combine.children[i].amount,callback:function(t){e.$set(e.combine.children[i],"amount",t)},expression:"combine.children[index].amount"}})],1)})),1):e._e()],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.showChooseDialog=!1}}},[e._v(" 取消 ")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.bindRel()}}},[e._v(" 确认 ")])],1)],1),a("el-dialog",{attrs:{title:"处理人",visible:e.handlerDialogVisible,width:"30%"},on:{"update:visible":function(t){e.handlerDialogVisible=t}}},[a("el-form",{ref:"handlerForm",staticStyle:{width:"400px","margin-left":"50px"},attrs:{model:e.handlerForm,"label-position":"left","label-width":"100px"}},[a("el-form-item",{attrs:{label:"处理人"}},[a("el-select",{attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入邮箱或者用户名","remote-method":e.searchUser,loading:e.loading},model:{value:e.handlerForm.handler_id,callback:function(t){e.$set(e.handlerForm,"handler_id",t)},expression:"handlerForm.handler_id"}},e._l(e.options,(function(e){return a("el-option",{key:e.id,attrs:{label:e.username,value:e.id}})})),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.handlerDialogVisible=!1}}},[e._v(" 取消 ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.bindHandler}},[e._v(" 确认 ")])],1)],1)],1)},l=[],r=a("5530"),n=(a("4de4"),a("d3b7"),a("e9c4"),a("d81d"),a("a434"),a("b775"));function o(e){return Object(n["a"])({url:"/api/material_seq",method:"post",data:e})}function s(e){return Object(n["a"])({url:"/api/material_tree",method:"get",params:e})}function c(e,t){return Object(n["a"])({url:"/api/materials/".concat(e),method:"put",data:t})}function d(e,t){return Object(n["a"])({url:"/api/materials/".concat(e,"/rel"),method:"post",data:t})}function u(e){return Object(n["a"])({url:"/api/categories",method:"get",params:e})}function h(e,t){return Object(n["a"])({url:"/api/categories/".concat(e,"/handler"),method:"post",params:t})}var f=a("c24f"),m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"custom-tree-container"},[a("el-dialog",{attrs:{visible:e.visible,"append-to-body":""},on:{close:e.handleClose}},[a("el-form",{ref:"materialForm",staticStyle:{width:"400px","margin-left":"50px"},attrs:{rules:e.rules,model:e.material,"label-position":"left","label-width":"120px"}},[a("el-form-item",{attrs:{label:"物料类型",prop:"type"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.material.type,callback:function(t){e.$set(e.material,"type",t)},expression:"material.type"}},e._l(e.material_types[e.dialogType],(function(e){return a("el-option",{key:e.key,staticClass:"el-item",attrs:{label:e.key,value:e.val}})})),1)],1),a("el-form-item",{attrs:{label:"物料编号",prop:"label"}},[a("el-input",{staticClass:"small_input",attrs:{disabled:!0},model:{value:e.material.label,callback:function(t){e.$set(e.material,"label",t)},expression:"material.label"}}),a("el-button",{staticClass:"el-item",staticStyle:{float:"left","margin-left":"20px"},attrs:{type:"primary"},on:{click:e.getMaterialSeqNum}},[e._v("获取编码")])],1),"component"!=e.dialogType?a("el-form-item",{attrs:{label:"是否有子分类",prop:"has_child"}},[a("el-radio",{attrs:{label:"1"},model:{value:e.material.has_child,callback:function(t){e.$set(e.material,"has_child",t)},expression:"material.has_child"}},[e._v("是")]),a("el-radio",{attrs:{label:"0",checked:"checked"},model:{value:e.material.has_child,callback:function(t){e.$set(e.material,"has_child",t)},expression:"material.has_child"}},[e._v("否")])],1):e._e(),a("el-form-item",{attrs:{label:"描述",prop:"description"}},[a("el-input",{staticClass:"small_input el-item",attrs:{type:"textarea",rows:4},model:{value:e.material.description,callback:function(t){e.$set(e.material,"description",t)},expression:"material.description"}})],1),a("el-form-item",{attrs:{label:"附件"}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"uploadFile","before-upload":e.beforeUpload,"on-remove":e.handleRemove,"file-list":e.fileList}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(){return e.addMaterial()}}},[e._v(" 确认 ")])],1)],1)],1)},p=[],y=(a("a15b"),a("b0c0"),a("91b6")),b={name:"Material",props:{need_refresh:{type:Boolean,default:!1},category:{type:Object},visible:{type:Boolean},dialogType:{type:String,default:"category"}},data:function(){return{refresh:!1,dialogFormVisible:!1,fileList:[],material_types:{category:[{key:"装配体",val:"assembly"}],assembly:[{key:"子装配体",val:"sub-assembly"},{key:"零件",val:"component"}],"sub-assembly":[{key:"零件",val:"component"}],component:[{key:"公用零件",val:"single-component"}]},material:{parent_id:0,category_id:0,type:"",seq:"",label:"",has_child:"0",amount:1,file_ids:"",children:[]},rules:{type:[{required:!0,message:"请先选择物料类型",trigger:"blur"}],label:[{required:!0,message:"请获取物料编码",trigger:"blur"}],has_child:[{required:!0,message:"请选择是否有子分类",trigger:"change"}]}}},methods:{handleClose:function(){this.$emit("update:visible",!1),this.$emit("update:need_refresh",!0),this.material={parent_id:0,category_id:0,type:"",seq:"",label:"",has_child:"0",amount:1,file_ids:"",children:[]}},addMaterial:function(){var e=this;this.material.category_id=this.category.id;for(var t=[],a=0;a<this.fileList.length;a++)t.push(this.fileList[a].id);this.material.file_ids=t.join(),this.$nextTick((function(){e.$refs["materialForm"].validate((function(t){t&&c(e.material.id,e.material).then((function(t){e.handleClose()}))}))}))},getMaterialSeqNum:function(){var e=this,t={category_id:this.category.id,type:this.material.type};0!=this.category.id&&""!=this.material.type?o(t).then((function(t){e.material.seq=t.data.seq,e.material.label=e.category.name+t.data.seq,e.material.id=t.data.id})):this.$message({showClose:!0,message:"请先选择物料类型",type:"error"})},handleRemove:function(e,t){this.fileList=t},beforeUpload:function(e,t){var a=this,i=new FormData;i.append("file",e),i.append("type","file"),i.append("source_type","material"),Object(y["a"])(i).then((function(e){a.fileList.push(e.data)}))}}},g=b,_=(a("6d5e"),a("2877")),v=Object(_["a"])(g,m,p,!1,null,null,null),k=v.exports,w=a("622d"),x=a("2f62"),C={name:"MaterialIndex",components:{Material:k,QueryCol:w["a"]},computed:Object(r["a"])({},Object(x["b"])(["permissions"])),filters:{typesMap:function(e){var t={category:"",assembly:"装配体","sub-assembly":"子装配体",component:"零件","single-component":"公用零件"};return t[e]},colorsMap:function(e){var t={category:"success",assembly:"primary","sub-assembly":"info",component:"warning","single-component":"danger"};return t[e]}},data:function(){return{options:[],loading:!1,tree:[],filterText:"",category_id:0,category:null,need_refresh:!1,showChooseDialog:!1,data:[],dialogFormVisible:!1,handlerDialogVisible:!1,dialogType:"category",listQuery:{page:1,per_page:10,filter_col:"",filter_val:""},combine:{material_id:0,children:[]},cols:[{key:"name",name:"分类名"},{key:"children.filter_label",name:"物料名称"},{key:"children.filter_description",name:"物料描述"}],handlerForm:{handler_id:"",category_id:0}}},watch:{need_refresh:{handler:function(e,t){e!=t&&this.getTreeData()}},filterText:function(e){this.$refs.tree.filter(e)}},created:function(){this.listQuery.page=1,this.$route.query.category_name&&(this.listQuery.filter_col="name",this.listQuery.filter_val=this.$route.query.category_name),this.getList()},methods:{showAddHandlerDialog:function(e){var t=this;this.$nextTick((function(){t.handlerForm={handler_id:"",category_id:e.id},t.handlerDialogVisible=!0,t.searchUser()}))},searchUser:function(e){var t=this;Object(f["f"])({keyword:e}).then((function(e){t.options=e.data}))},bindHandler:function(){var e=this;h(this.handlerForm.category_id,this.handlerForm).then((function(t){e.handlerDialogVisible=!1,e.retrieve()}))},getTreeData:function(){var e=this,t={filter_category_id:this.category_id,material_id:this.combine.material_id};return s(t).then((function(t){e.tree=t.data.tree,e.category=t.data.category}))},showChoose:function(e,t){var a=this;this.showChooseDialog=!0,this.category_id=t.category_id,this.dialogType=e;var i=JSON.parse(JSON.stringify(t));this.$nextTick((function(){a.$refs["combineForm"].resetFields(),a.combine.material_id=i.id,a.combine.children=i.children,a.getTreeData();for(var e=[],t=0;t<i.children.length;t++)e.push(i.children[t].label);a.$refs.tree.setCheckedKeys(e)}))},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},checkChange:function(e,t,a){if(e.id>0)if(t){var i={id:e.id,label:e.label,amount:1};this.combine.children.push(i)}else{var l=this.combine.children.map((function(e){return e.id})).indexOf(e.id);this.combine.children.splice(l,1)}},showAddMaterialDialog:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.dialogType=e,this.dialogFormVisible=!0,t&&(this.category=JSON.parse(JSON.stringify(t)))},getList:function(){var e=this;return u(this.listQuery).then((function(t){t.data.length>0?e.data=t.data:e.data=[]}))},handleFilter:function(e){this.listQuery.page=1,this.listQuery.filter_col=e.col?e.col:"",this.listQuery.filter_val=e.val?e.val:"",this.getList()},retrieve:function(){var e=this;this.getList().then((function(t){e.dialogFormVisible=!1,e.$notify({title:"Success",message:"操作成功",type:"success",duration:2e3})}))},bindRel:function(){var e=this;0!=this.combine.children.length?d(this.combine.material_id,this.combine).then((function(t){e.showChooseDialog=!1,e.retrieve()})):this.$message({showClose:!0,message:"请选择子物料",type:"error"})}}},S=C,F=(a("95f9"),Object(_["a"])(S,i,l,!1,null,null,null));t["default"]=F.exports},ec9d:function(e,t,a){}}]);